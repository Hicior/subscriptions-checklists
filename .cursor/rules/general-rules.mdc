---
alwaysApply: true
---

## MANDATORY RULES

- .env file is located in the root folder. You can't see it but it's there.

## .env file variables

*Azure App - MySharepointExcelUpdater*
ApplicationID=your_application_id
DirectoryID=your_directory_id
SecretID=your_secret_id
SecretValue=your_secret_value
STRIPE_API_KEY=your_stripe_api_key
CALENDESK_API_KEY=your_calendesk_api_key

## Main Excel File structure

File name: "Status przekazanych klientów - Kraków - test.xlsx"
Location: Sharepoint

### Sheet name: "Subskrypcje klientów" ID: {71D43EB5-BDB5-4475-8792-24810E03FF04}

Table: Subskrypcje
Columns:
- ID Subskrypcji Klienta
- ID Subskrypcji
- Status
- Data zakupu
- Pakiet
- Data wygaśnięcia
- Data anulowania
- ID Klienta
- Imię i Nazwisko Klienta
- Email
- Typ pakietu
- ID Suba STRIPE
- NIP
- Nazwa Firmy
- Telefon
- Invoice status in chosen month (custom function required)
    Current Excel function: "=IF(
  [@[ID Suba STRIPE]]="";
  "Nie można określić";
  IF(
    [@[Typ pakietu]]="miesięczny";
    IFERROR(
      INDEX(
        FILTER(
          InvoicesTable[Status Faktury];
          (InvoicesTable[ID_Subskrypcji]=[@[ID Suba STRIPE]]) *
          (MONTH(InvoicesTable[Data Utworzenia])=6) *
          (YEAR(InvoicesTable[Data Utworzenia])=2025)
        );
        1
      );
      ""
    );
    IF(
      [@[Typ pakietu]]="roczny";
      IFERROR(
        INDEX(
          FILTER(
            InvoicesTable[Status Faktury];
            (InvoicesTable[ID_Subskrypcji]=[@[ID Suba STRIPE]]) *
            (InvoicesTable[Data Utworzenia]>=DATE(2024;6;1)) *
            (InvoicesTable[Data Utworzenia]<=DATE(2025;6;30))
          );
          1
        );
        ""
      );
      ""
    )
  )
)"
- Invoice status in last 2 months (custom function required)
    Current Excel function: "=IF(
  [@[ID Suba STRIPE]]="";
  "Nie można określić";
  IF(
    [@[Typ pakietu]]="miesięczny";
    IF(
      COUNTIFS(
        InvoicesTable[ID_Subskrypcji];[@[ID Suba STRIPE]];
        InvoicesTable[Data Utworzenia];">="&DATE(2025;6;1);
        InvoicesTable[Data Utworzenia];"<="&DATE(2025;7;31);
        InvoicesTable[Status Faktury];"paid"
      )>0;
      "paid";
      ""
    );
    IF(
      [@[Typ pakietu]]="roczny";
      IF(
        COUNTIFS(
          InvoicesTable[ID_Subskrypcji];[@[ID Suba STRIPE]];
          InvoicesTable[Data Utworzenia];">="&DATE(2024;6;1);
          InvoicesTable[Data Utworzenia];"<="&DATE(2025;7;31);
          InvoicesTable[Status Faktury];"paid"
        )>0;
        "paid";
        ""
      );
      ""
    )
  )
)"
- Last invoice month (custom function required)
    Current Excel function = "=IFERROR(
  TEXT(
    MAX(
      FILTER(
        InvoicesTable[Data Utworzenia];
        (InvoicesTable[ID_Subskrypcji]=[@[ID Suba STRIPE]]) *
        (InvoicesTable[Status Faktury]="paid") *
        IF(
          [@[Typ pakietu]]="miesięczny";
          YEAR(InvoicesTable[Data Utworzenia])=2025;
          InvoicesTable[Data Utworzenia]>=DATE(2024;1;1)
        )
      )
    );
    "mmmm"
  );
  ""
)"
- Status3 (custom function required)
    Current Excel function: "=IF(
    AND(
        [@[Data wygaśnięcia]] > NOW();
        NOT(ISBLANK([@[Data wygaśnięcia]]));
        NOT(ISBLANK([@[ID Subskrypcji Klienta]]))
    );
    "Anulowana (aktywna)";
    IF(
        AND(
            OR([@[Data wygaśnięcia]] > NOW(); ISBLANK([@[Data wygaśnięcia]]));
            NOT(ISBLANK([@[ID Subskrypcji Klienta]]))
        );
        "Aktywna";
        IF(
            AND(
                [@[Data wygaśnięcia]] <= NOW();
                NOT(ISBLANK([@[ID Subskrypcji Klienta]]))
            );
            "Anulowana";
            "Nieokreślony"
        )
    )
)"
- Grupa (custom function in excel, handled by the user)
- Grupa2 (custom function in excel, handled by the user)
- Grupa3 (custom function in excel, handled by the user)

### Sheet name: "ID subów" ID: {44FC2DC5-B0D7-484E-9126-87CE4D7F5F01}

Table: IDSubów
Columns:
- ID Suba (the same as "ID Subskrypcji" in "Subskrypcje klientów" sheet)
- Pakiet
- Grupa
- Grupa2
- Grupa3
- Okres odnowienia
- Cena brutto